<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KeyçŠ¶æ€ç®¡ç†æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 20px;
            background-color: #f5f5f7;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }
        .test-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }
        .key-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
        }
        .key-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .key-status-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        .test-btn {
            padding: 8px 16px;
            background: #007aff;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
        }
        .test-btn:hover {
            background: #0056b3;
        }
        .status-log {
            margin-top: 15px;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
        }
        .log-success { color: #28a745; }
        .log-error { color: #dc3545; }
        .log-info { color: #007aff; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>KeyçŠ¶æ€ç®¡ç†æµ‹è¯•</h1>
        
        <div class="test-section">
            <div class="test-title">ä¸»KeyçŠ¶æ€æµ‹è¯•</div>
            <div class="key-row">
                <input type="password" class="key-input" id="mainKey" placeholder="ä¸»API Key" value="sk-test-main-key-123456">
                <button class="key-status-btn main-key-status" data-status="enabled" data-enabled="true" onclick="testMainKeyToggle(this)" title="ä¸»Key(å·²å¯ç”¨)">ğŸŸ¢</button>
                <button class="test-btn" onclick="testMarkMainKeyFailed()">æ ‡è®°å¤±è´¥</button>
                <button class="test-btn" onclick="resetMainKey()">é‡ç½®</button>
            </div>
            <div id="mainKeyStatus" class="status-log"></div>
        </div>
        
        <div class="test-section">
            <div class="test-title">å‰¯KeyçŠ¶æ€æµ‹è¯•</div>
            <div class="key-row">
                <input type="password" class="key-input" placeholder="å‰¯API Key 1" value="sk-test-secondary-key-1">
                <button class="key-status-btn" data-status="disabled" data-enabled="false" onclick="testSecondaryKeyToggle(this)" title="å‰¯Key(æœªå¯ç”¨)">âšª</button>
            </div>
            <div class="key-row">
                <input type="password" class="key-input" placeholder="å‰¯API Key 2" value="sk-test-secondary-key-2">
                <button class="key-status-btn" data-status="disabled" data-enabled="false" onclick="testSecondaryKeyToggle(this)" title="å‰¯Key(æœªå¯ç”¨)">âšª</button>
            </div>
            <div id="secondaryKeyStatus" class="status-log"></div>
        </div>
        
        <div class="test-section">
            <div class="test-title">æµ‹è¯•ç”¨ä¾‹</div>
            <button class="test-btn" onclick="runAllTests()">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
            <button class="test-btn" onclick="clearLogs()">æ¸…ç©ºæ—¥å¿—</button>
            <div id="testLog" class="status-log"></div>
        </div>
    </div>

    <script>
        // æ—¥å¿—å‡½æ•°
        function log(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            container.appendChild(entry);
            container.scrollTop = container.scrollHeight;
        }

        // æµ‹è¯•ä¸»Keyåˆ‡æ¢
        function testMainKeyToggle(button) {
            const currentStatus = button.dataset.status;
            log('mainKeyStatus', `ä¸»KeyçŠ¶æ€åˆ‡æ¢: ${currentStatus}`, 'info');
            
            // æ¨¡æ‹Ÿä¸‰æ€åˆ‡æ¢é€»è¾‘
            switch (currentStatus) {
                case 'enabled':
                    button.dataset.status = 'failed';
                    button.dataset.enabled = 'false';
                    button.style.backgroundColor = '#dc3545';
                    button.textContent = 'ğŸ”´';
                    button.title = 'ä¸»Keyæ ‡è®°å¤±è´¥ (ç‚¹å‡»é‡æ–°å¯ç”¨)';
                    log('mainKeyStatus', 'ä¸»Key: å¯ç”¨ â†’ å¤±è´¥', 'error');
                    break;
                case 'failed':
                    button.dataset.status = 'enabled';
                    button.dataset.enabled = 'true';
                    button.style.backgroundColor = '#28a745';
                    button.textContent = 'ğŸŸ¢';
                    button.title = 'ä¸»Keyå·²å¯ç”¨ (ç‚¹å‡»è®¾ä¸ºå¤±è´¥)';
                    log('mainKeyStatus', 'ä¸»Key: å¤±è´¥ â†’ å¯ç”¨', 'success');
                    break;
                case 'disabled':
                    button.dataset.status = 'enabled';
                    button.dataset.enabled = 'true';
                    button.style.backgroundColor = '#28a745';
                    button.textContent = 'ğŸŸ¢';
                    button.title = 'ä¸»Keyå·²å¯ç”¨ (ç‚¹å‡»è®¾ä¸ºå¤±è´¥)';
                    log('mainKeyStatus', 'ä¸»Key: ç¦ç”¨ â†’ å¯ç”¨', 'success');
                    break;
            }
        }

        // æµ‹è¯•å‰¯Keyåˆ‡æ¢
        function testSecondaryKeyToggle(button) {
            const currentStatus = button.dataset.status;
            log('secondaryKeyStatus', `å‰¯KeyçŠ¶æ€åˆ‡æ¢: ${currentStatus}`, 'info');
            
            switch (currentStatus) {
                case 'disabled':
                    button.dataset.status = 'enabled';
                    button.dataset.enabled = 'true';
                    button.style.backgroundColor = '#28a745';
                    button.textContent = 'ğŸŸ¢';
                    button.title = 'å‰¯Keyå·²å¯ç”¨ (ç‚¹å‡»ç¦ç”¨)';
                    log('secondaryKeyStatus', 'å‰¯Key: ç¦ç”¨ â†’ å¯ç”¨', 'success');
                    // ç¦ç”¨å…¶ä»–å‰¯Key
                    document.querySelectorAll('.key-status-btn:not(.main-key-status)').forEach(btn => {
                        if (btn !== button) {
                            btn.dataset.status = 'disabled';
                            btn.dataset.enabled = 'false';
                            btn.style.backgroundColor = '#6c757d';
                            btn.textContent = 'âšª';
                            btn.title = 'å‰¯Key(æœªå¯ç”¨)';
                        }
                    });
                    break;
                case 'enabled':
                    button.dataset.status = 'failed';
                    button.dataset.enabled = 'false';
                    button.style.backgroundColor = '#dc3545';
                    button.textContent = 'ğŸ”´';
                    button.title = 'å‰¯Keyæ ‡è®°å¤±è´¥ (ç‚¹å‡»é‡æ–°å¯ç”¨)';
                    log('secondaryKeyStatus', 'å‰¯Key: å¯ç”¨ â†’ å¤±è´¥', 'error');
                    break;
                case 'failed':
                    button.dataset.status = 'enabled';
                    button.dataset.enabled = 'true';
                    button.style.backgroundColor = '#28a745';
                    button.textContent = 'ğŸŸ¢';
                    button.title = 'å‰¯Keyå·²å¯ç”¨ (ç‚¹å‡»ç¦ç”¨)';
                    log('secondaryKeyStatus', 'å‰¯Key: å¤±è´¥ â†’ å¯ç”¨', 'success');
                    // ç¦ç”¨å…¶ä»–å‰¯Key
                    document.querySelectorAll('.key-status-btn:not(.main-key-status)').forEach(btn => {
                        if (btn !== button) {
                            btn.dataset.status = 'disabled';
                            btn.dataset.enabled = 'false';
                            btn.style.backgroundColor = '#6c757d';
                            btn.textContent = 'âšª';
                            btn.title = 'å‰¯Key(æœªå¯ç”¨)';
                        }
                    });
                    break;
            }
        }

        // æ ‡è®°ä¸»Keyä¸ºå¤±è´¥
        function testMarkMainKeyFailed() {
            const button = document.querySelector('.main-key-status');
            button.dataset.status = 'failed';
            button.dataset.enabled = 'false';
            button.style.backgroundColor = '#dc3545';
            button.textContent = 'ğŸ”´';
            button.title = 'ä¸»Keyæ ‡è®°å¤±è´¥ (ç‚¹å‡»é‡æ–°å¯ç”¨)';
            log('mainKeyStatus', 'ä¸»Keyè¢«æ ‡è®°ä¸ºå¤±è´¥çŠ¶æ€', 'error');
            log('testLog', 'æµ‹è¯•æ ‡è®°ä¸»Keyå¤±è´¥: æˆåŠŸ', 'success');
        }

        // é‡ç½®ä¸»Key
        function resetMainKey() {
            const button = document.querySelector('.main-key-status');
            button.dataset.status = 'enabled';
            button.dataset.enabled = 'true';
            button.style.backgroundColor = '#28a745';
            button.textContent = 'ğŸŸ¢';
            button.title = 'ä¸»Keyå·²å¯ç”¨ (ç‚¹å‡»è®¾ä¸ºå¤±è´¥)';
            log('mainKeyStatus', 'ä¸»Keyå·²é‡ç½®ä¸ºå¯ç”¨çŠ¶æ€', 'success');
        }

        // è¿è¡Œæ‰€æœ‰æµ‹è¯•
        function runAllTests() {
            log('testLog', 'å¼€å§‹è¿è¡Œæ‰€æœ‰æµ‹è¯•...', 'info');
            
            // æµ‹è¯•1: ä¸»Keyä¸‰æ€åˆ‡æ¢
            log('testLog', 'æµ‹è¯•1: ä¸»Keyä¸‰æ€åˆ‡æ¢', 'info');
            const mainBtn = document.querySelector('.main-key-status');
            testMainKeyToggle(mainBtn); // enabled -> failed
            testMainKeyToggle(mainBtn); // failed -> enabled
            
            // æµ‹è¯•2: å‰¯Keyå¯ç”¨
            log('testLog', 'æµ‹è¯•2: å‰¯Keyå¯ç”¨', 'info');
            const secondaryBtns = document.querySelectorAll('.key-status-btn:not(.main-key-status)');
            testSecondaryKeyToggle(secondaryBtns[0]); // å¯ç”¨ç¬¬ä¸€ä¸ªå‰¯Key
            
            // æµ‹è¯•3: ä¸»Keyåº”è¯¥è‡ªåŠ¨ç¦ç”¨
            setTimeout(() => {
                const mainStatus = mainBtn.dataset.status;
                if (mainStatus === 'disabled') {
                    log('testLog', 'æµ‹è¯•3: å‰¯Keyå¯ç”¨æ—¶ä¸»Keyè‡ªåŠ¨ç¦ç”¨ - æˆåŠŸ', 'success');
                } else {
                    log('testLog', 'æµ‹è¯•3: å‰¯Keyå¯ç”¨æ—¶ä¸»Keyè‡ªåŠ¨ç¦ç”¨ - å¤±è´¥', 'error');
                }
            }, 100);
            
            // æµ‹è¯•4: æ ‡è®°å¤±è´¥
            log('testLog', 'æµ‹è¯•4: æ ‡è®°Keyå¤±è´¥', 'info');
            testMarkMainKeyFailed();
            
            log('testLog', 'æ‰€æœ‰æµ‹è¯•å®Œæˆï¼', 'success');
        }

        // æ¸…ç©ºæ—¥å¿—
        function clearLogs() {
            document.querySelectorAll('.status-log').forEach(log => {
                log.innerHTML = '';
            });
            log('testLog', 'æ—¥å¿—å·²æ¸…ç©º', 'info');
        }

        // åˆå§‹åŒ–
        window.onload = function() {
            log('testLog', 'KeyçŠ¶æ€ç®¡ç†æµ‹è¯•é¡µé¢å·²åŠ è½½', 'success');
        };
    </script>
</body>
</html>